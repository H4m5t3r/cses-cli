openapi: 3.0.3

info:
  title: CSES API
  description: API describing the communication between CSES CLI and cses.fi
  version: 0.0.1
  license:
    name: MIT
    url: https://github.com/H4m5t3r/cses-cli/blob/main/LICENSE




components:
  schemas:
    ErrorMessage:
      additionalProperties: false
      required:
        - message
      type: object
      properties:
        message:
          description: Error message from the server.
          type: string

  # define possible authentication methods
  securitySchemes:
    apiKeyAuth: # could be any name
      type: apiKey
      in: header
      name: X-Auth-Token

security:
  - apiKeyAuth: []

paths:
  /login:
    post:
      # unique id for mocking
      operationId: app.login_get

      summary: Logs in the user with CSES credentials
      description: |
        Logs the user in with CSES credentials. Returns an API token
        that can be used to authenticate subsequent API queries.

      security: []

      requestBody:
        required: true
        content:
          application/json:
            schema:
              required:
                - username
                - password
              additionalProperties: false

              type: object
              properties:
                username:
                  description: A CSES username
                  type: string
                password:
                  description: A CSES password
                  type: string

      responses:
        "200":
          description: >
            Authentication successful. X-Auth-Token is returned as a
            json object.
          content:
            application/json:
              schema:
                type: object
                additionalProperties: false
                required:
                  - X-Auth-Token
                properties:
                  X-Auth-Token:
                    description: API token used to authenticate the user.
                    type: string

              examples:
                example1:
                  summary: An example session ID
                  value:
                    X-Auth-Token: "123"

        "401":
          description: Invalid username/password.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorMessage"

        "4XX":
          description: General client side error.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorMessage"
              examples:
                example1:
                  summary: An example error message
                  value:
                    message: "Too many requests"

        "5XX":
          description: Server error.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorMessage"

  /logout:
    post:
      operationId: app.logout_post

      summary: Deauthorizes the given authorization token.
      description: >
        Deauthorizes the valid authentication token. Returns if the
        deauthorization was successful or not.

      security: []

      requestBody:
        required: false
        content:
          application/json:
            schema:
              required:
                - X-Auth-Token
              additionalProperties: false

              type: object
              properties:
                X-Auth-Token:
                  description: A valid authorization token
                  type: string

      responses:
        "200":
          description: >
            Valid authentication token which has hopefully now been devalidated.
          content:
            application/json:
              schema:
                type: object
                additionalProperties: false
                required:
                  - Success
                properties:
                  Success:
                    description: True if successfully devalidated
                    type: boolean

        "401":
          description: Invalid authorization token
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorMessage"

        "4XX":
          description: General client side error.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorMessage"
              examples:
                example1:
                  summary: An example error message
                  value:
                    message: "Too many requests"

        "5XX":
          description: Server error.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorMessage"
